<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Optimized Route Recommender</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      display: flex;
      height: 100vh;
      margin: 0;
    }
    .sidebar {
      width: 250px;
      background-color: #f5f5f5;
      padding: 20px;
      border-right: 1px solid #ccc;
    }
    .sidebar h2 {
      font-size: 18px;
      margin-bottom: 10px;
    }
    .sidebar select {
      width: 100%;
      padding: 8px;
      font-size: 16px;
    }
    .main-content {
      flex: 1;
      padding: 20px;
      display: flex;
      flex-direction: column;
      gap: 20px;
    }
    .graph-section {
      display: flex;
      justify-content: space-around;
      flex-wrap: wrap;
    }
    svg {
      border: 1px solid #ccc;
    }
  </style>
</head>
<body>
  <div class="sidebar">
    <h2>ğŸ§  Prediction View</h2>
    <select id="view-mode">
      <option value="latency">âœ… Latency Prediction</option>
      <option value="alarm">â³ Node Health (Alarm Prediction)</option>
      <option value="risk">ğŸ” Path Risk Score</option>
    </select>
  </div>

  <div class="main-content">
    <h2 id="view-title">Latency Prediction</h2>
    <div class="graph-section">
      <div>
        <h3>ğŸ“¡ Real-Time Graph</h3>
        <svg id="realtime-graph" width="600" height="400"></svg>
      </div>
      <div>
        <h3>ğŸ”® Predicted Graph</h3>
        <svg id="predicted-graph" width="600" height="400"></svg>
      </div>
    </div>
  </div>

  <script src="https://d3js.org/d3.v7.min.js"></script>
  <script>
    const modeSelect = document.getElementById('view-mode');
    const viewTitle = document.getElementById('view-title');

    modeSelect.addEventListener('change', () => {
      const mode = modeSelect.value;
      viewTitle.textContent = modeSelect.options[modeSelect.selectedIndex].text;
      loadGraphs(mode);
    });

    function loadGraphs(mode) {
      const baseFile = `graph-data/${mode}`;
      Promise.all([
        d3.json(`${baseFile}_live.json`),
        d3.json(`${baseFile}_predicted.json`)
      ]).then(([live, pred]) => {
        renderGraph('#realtime-graph', live, false);
        renderGraph('#predicted-graph', pred, true);
      });
    }

    function renderGraph(svgSelector, graph, isPredicted) {
      const svg = d3.select(svgSelector);
      svg.selectAll('*').remove();

      const link = svg.selectAll('.link')
        .data(graph.links)
        .enter()
        .append('line')
        .attr('class', 'link')
        .attr('stroke', d => {
          const val = isPredicted ? d.properties?.predicted_latency_ms : d.properties?.latency_ms;
          if (val > 30) return 'red';
          if (val > 20) return 'orange';
          return 'green';
        })
        .attr('stroke-width', 2);

      const node = svg.selectAll('.node')
        .data(graph.nodes)
        .enter()
        .append('circle')
        .attr('class', 'node')
        .attr('r', 6)
        .attr('cx', (d, i) => 50 + (i % 10) * 60)
        .attr('cy', (d, i) => 50 + Math.floor(i / 10) * 60)
        .attr('fill', 'steelblue')
        .append('title')
        .text(d => d.id);
    }

    loadGraphs('latency');
  </script>
</body>
</html>
